FROM centos:centos7
MAINTAINER Zenoss <dev@zenoss.com>

RUN yum clean all

# Add zenoss tools
RUN yum --exclude=systemd\* --exclude=iputils\* update -y && \

# TODO: change this repo to use zenoss yum repo
yum install epel-release -y && \

rpmdb --rebuilddb && \
yum install -y \
    vim \
    which \
    gzip \
    tar \
    wget \
    traceroute \
    zip \
    file \
    vim \
    telnet \
    openssh-clients \
    memcached \
    MySQL-python \
    binutils \
    device-mapper-libs \
    libaio \
    libgomp \
    libpcre \
    libssl \
    libutil \
    libz \
    net-snmp \
    openssl-devel \
    pcre-devel \
    protobuf-python \
    alsa-lib \
    bind-libs \
    bind-license \
    bind-utils \
    flac-libs \
    gsm \
    java-1.7.0-openjdk \
    javapackages-tools \
    jline \
    jpackage-utils \
    libXtst \
    libart_lgpl \
    libasyncns \
    libgcj \
    libogg \
    libsndfile \
    libtirpc \
    libvorbis \
    nagios-common \
    nagios-plugins-perl \
    perl-Digest-MD5 \  #for percona
    perl-Time-HiRes \  #for percona
    pulseaudio-libs \
    rhino \
    rpcbind \
    ttmkfdir \
    tzdata-java \
    xorg-x11-fonts-Type1 \
    salt-master \
    salt-minion && \
yum erase epel-release -y && \
yum clean all

# Symlink /etc/localtime
RUN rm -f /etc/localtime && ln -s /usr/share/zoneinfo/UTC /etc/localtime

# Creating sym link to remedy library import of serviced
RUN ln -s /lib64/libdevmapper.so.1.02 /lib64/libdevmapper.so.1.02.1

ADD ./rpm/pkgroot/%RPM% /tmp/%RPM%
RUN rpmdb --rebuilddb && yum -y localinstall /tmp/%RPM%

RUN rm -rf /tmp/*
